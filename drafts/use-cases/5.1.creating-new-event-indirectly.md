## Creating new event indirectly

### Story

As an API publisher
I want allow consumers to construct event's identifier
So that they can control the .

As an API consumer
I want to be able to create new resources of a given type
So I can produce content.

### Usage

``` js
var event = {
    "@context": "/api/context.jsonld",
    "@type": "schema:Event",
    "eventName": "My brand new event",
    "eventDescription": "Hope it will work",
    "startDate": "2017-04-19",
    "endDate": "2017-04-19"
};
var templateVariables = {
    "slug": [
        "meeting",
        "with-will"
    ]
};

var client = new HydraClient();
var operation = client.get("http://example.com/events")
    .getOperationOfType('http://schema.org/CreateAction', /* recursive */ true)
    .filter(operation => operation.expects === 'http://schema.org/Event');
    
client.invoke(operation, event, templateVariables);
```

### Details

To create an `Event` using `PUT`, the collection resource has to be linked to the actual target of the operation.
This linked object can be a concrete resource or an `IriTemplate` as presented in the above snippet. In this case 
the representation of the collection resource is not unlike that seen in the [Searching events use case](7.searching-events.md)

```http
GET /api/events
```

```http
HTTP 200 OK
```

``` json
{
    "@context": "/api/context.jsonld",
    "@id": "/api/events",
    "@type": "hydra:Collection",
    "manages": {
      "property": "rdf:type",
      "object": "schema:Event"
    },
    "totalItems": 0,
    "members": [ ],
    "http://example.com/vocab/createEvent": {
        "@type": "IriTemplate",
        "hydra:template": "http://example.com/api/event{/slug*}",
        "hydra:variableRepresentation": "hydra:BasicRepresentation",
        "hydra:mapping": [
            {
                "@type": "hydra:IriTemplateMapping",
                "variable": "slug",
                "property": "xsd:String",
                "required": true
            }
        ],
        "hydra:operation": [
            "@type": [ "hydra:Operation", "schema:CreateAction" ],
            "title": "Create new event",
            "method": "PUT",
            "expects": "schema:Event"
        ]
    }
}
```

Upon executing the snippet above the following request will be sent to the server:

``` http
PUT /api/event/meeting/with-will HTTP/1.1
Host: http://example.com
```

``` json
{
    "@context": "/api/context.jsonld",
    "@type": "schema:Event",
    "eventName": "My brand new event",
    "eventDescription": "Hope it will work",
    "startDate": "2017-04-19",
    "endDate": "2017-04-19"
}
```

``` http
HTTP/1.1 201 Created
```

### Considerations

#### Requesting an existing URI

It is possible that the identifier constructed by filling in `IriTemplate` variables already contains a representation of 
an event. By the absence of `@id` in the request's payload the server can determine that this request is an attempt to create
an new resource and not update the existing one. This specification doesn't mandate any correct behaviour on the server part.

An expected response could be `HTTP/1.1 409 Conflict`. However the server can also allow the representation to be replaced
as in the [Updating Event Use Case](6.updating-event.md) in which case it would response with a 2xx status code.

#### Advertising connection between collection and created event

Even though the `schema:CreateAction` operation exists within the collection's representation it is not right to assume that
the newly created event will become part of the collection, ie. it's `"hydra:member"` property. What's more, a single
operation can have an effect on more that one related resource. For example, in a more elaborate setting, creating a personal
event can also add that event to the events collection of all participants.

There can be many such cases and defining all possibilities is likely outside of Hydra's scope
