# Creating relations between existing resources

## Story

As an application user
I want to be able to add people to the list of event attendees
So I know who attended the event

As an application user
I want to be able to add event to the list of events I attended
So I can keep track on events I attended

As an API consumer
I want to be able to link existing resources using specific property
So I can create various meaningful relations


## Details

Each event can advertise an action to link it to another resource using
specific property (sometimes called relation or predicate). In this case it only
gets included in responses to authenticated requests, since target of operation
that handles such action depends on identity of the person using application.
Here `tbd:triplePattern` does include value for `subject` since person can only
link oneself as attending an event.



```http
GET /api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31
```

```http
HTTP 200 OK
```

```json
{
    "@context": "/context.jsonld",
    "@id": "/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
    "@type": "schema:Event",
    "eventName": "Event 1",
    "action": {
        "@type:": "tbd:LinkAction",
        "title": "Add event attendee",
        "expects": "rdf:Statement",
        "tbd:triplePattern": {
            "subject": "/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
            "property": "schema:attendee",
            "object": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c"
        },
        "operation": {
            "@type": "Operation",
            "method": "PUT",
            "target": {
                "@type": "IriTemplate",
                "template": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c/attended/{uuid}",
                "variableRepresentation": "BasicRepresentation",
                "mapping": [
                    {
                        "@type": "IriTemplateMapping",
                        "variable": "uuid",
                        "property": "schema:uuid",
                        "required": true
                    }
                ]
            }
        }
    }
}
```

Similarly, each person can advertise action to link it to another resource,
in this case using the same specific property (sometimes called relation or predicate).
Here `tbd:triplePattern` does not include value for `subject` since person can link onself
as attending any event.


```http
GET /api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c
```

```http
HTTP 200 OK
```

```json
{
    "@context": "/context.jsonld",
    "@id": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c",
    "@type": "schema:Person",
    "schema:name": "Alice Foobarion",
    "action": {
        "@type:": "tbd:LinkAction",
        "title": "Add event attendee",
        "expects": "rdf:Statement",
        "tbd:triplePattern": {
            "property": "schema:attendee",
            "object": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c"
        },
        "operation": {
            "@type": "Operation",
            "method": "PUT",
            "target": {
                "@type": "IriTemplate",
                "template": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c/attended/{uuid}",
                "variableRepresentation": "BasicRepresentation",
                "mapping": [
                    {
                        "@type": "IriTemplateMapping",
                        "variable": "uuid",
                        "property": "schema:uuid",
                        "required": true
                    }
                ]
            }
        }
    }
}
```

Since both resources originate from two different datasets. Client application could
add relation based on `schema:attendee` to both datasets.

```http
PUT /api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c/attended/61d4db0b-91da-46ce-8cca-afc8dc3eaa34
```

```jsonld
"@id": "https://example.org/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
"https://schema.org/attendee": "https://example.org/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c"
```

``` http
HTTP/1.1 201 Created
```

Now dataset includes relation between given event and given person. One will see it in
results of [Tripple Pattern Fragment](https://www.hydra-cg.com/spec/latest/triple-pattern-fragments) queries based on patterns:

```json
{
  "rdf:subject": "https://example.org/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
  "rdf:predicate": "https://schema.org/attendee"
}
```

```json
{
  "rdf:predicate": "https://schema.org/attendee",
  "rdf:object": "https://example.org/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c"
}
```

This would also result in event providing `tbd:UnlinkAction` for the person who
attends particular event.

```http
GET /api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31
```

```http
HTTP 200 OK
```

```json
{
    "@context": "/context.jsonld",
    "@id": "/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
    "@type": "schema:Event",
    "eventName": "Event 1",
    "action": {
        "@type:": "tbd:UnlinkAction",
        "title": "Add event attendee",
        "tbd:triplePattern": {
            "subject": "/api/events/173a6d5b-e9fc-43d7-a19a-215a06d37f31",
            "property": "schema:attendee",
            "object": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c"
        },
        "operation": {
            "@type": "Operation",
            "method": "DELETE",
            "target": "/api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c/attended/61d4db0b-91da-46ce-8cca-afc8dc3eaa34"
        }
    }
}
```

Client can perform this action by

```http
DELETE /api/people/28c8610e-e291-4e5a-abd4-b3f8fe99b11c/attended/61d4db0b-91da-46ce-8cca-afc8dc3eaa34
```

``` http
HTTP/1.1 204 No Content
```
